<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<div class="catalogo-container">
  <h2 class="titulo">Selección de un vehículo</h2>

  <!-- Filtros -->
  <div class="filtros">
    <!-- Filtros por tipo de vehículo -->
    <ng-container *ngFor="let tipo of tiposVehiculo">
      <button class="filtro"
              [ngClass]="{ activo: filtrosActivos.includes('tipo:' + tipo) }"
              (click)="toggleFiltro('tipo:' + tipo)">
        {{ tipo | titlecase }}
      </button>
    </ng-container>

    <!-- Botón para limpiar -->
    <button class="filtro limpiar" (click)="limpiarFiltros()">
      Limpiar filtros
    </button>

    <!-- Filtros desplegables -->
    <ng-container *ngFor="let filtro of dropdownKeys">
      <div class="filtro-dropdown">
        <button class="filtro"
                [ngClass]="{ activo: isFiltroDropdownActivo(filtro) }"
                (click)="toggleDropdown(filtro)">
          {{ filtro | titlecase }}
          <span *ngIf="getCantidadSeleccionados(filtro) > 0" class="contador">
            ({{ getCantidadSeleccionados(filtro) }})
          </span>
        </button>
        <div class="dropdown-opciones" *ngIf="dropdowns[filtro]">
          <button
            *ngFor="let opcion of getOpcionesFiltro(filtro)"
            (click)="seleccionarFiltro(filtro, opcion)"
            [ngClass]="{ activo: filtrosActivos.includes(filtro + ':' + opcion) }">
            {{ opcion | titlecase }}
          </button>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Grid de vehículos -->
  <div class="grid-vehiculos">
    <div class="tarjeta-vehiculo" *ngFor="let vehiculo of vehiculosFiltrados">
      <div class="imagen-vehiculo">
        <img [src]="vehiculo.imagen"
             [alt]="vehiculo.modelo"
             (error)="vehiculo.imagen = 'assets/img/catalogo/default.png'">
      </div>

      <div class="info-vehiculo">
        <!-- Marca, modelo y año -->
        <div class="nombre-precio-vehiculo">
          <div class="nombre-vehiculo">
            <h3>{{ vehiculo.marca }}</h3>
            <p>{{ vehiculo.modelo }}</p>
            <p class="anio">{{ vehiculo.anio }}</p>
          </div>
          <div class="precio">
            <span class="cantidad">€{{ vehiculo.precio }}</span>
            <span class="por-dia">/día</span>
          </div>
        </div>

        <!-- Características -->
        <div class="caracteristicas-vehiculo">
          <div class="caracteristica">
            <i [ngClass]="vehiculo.transmision === 'MANUAL' ? 'fas fa-cog' : 'fas fa-car'"></i>
            <span>{{ vehiculo.transmision | titlecase }}</span>
          </div>
          <div class="caracteristica">
            <i [ngClass]="{
              'fas fa-gas-pump': vehiculo.combustible === 'GASOLINA' || vehiculo.combustible === 'GLP',
              'fas fa-industry': vehiculo.combustible === 'DIESEL',
              'fas fa-bolt': vehiculo.combustible === 'ELECTRICO'
            }"></i>
            <span>{{ vehiculo.combustible | titlecase }}</span>
          </div>
          <div class="caracteristica">
            <i class="fas fa-snowflake"></i>
            <span>{{ vehiculo.aireAcondicionado ? 'A/A' : 'Sin A/A' }}</span>
          </div>
        </div>

        <!-- Botón de acción -->
        <button class="boton-detalles" (click)="verDetalles(vehiculo)">Ver detalles</button>

      </div>
    </div>
  </div>
</div>
